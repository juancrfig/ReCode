<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Algorithm Practice - Spaced Repetition</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/java.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.15.0/ace.js"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <header class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800">Algorithm Practice</h1>
            <div class="flex gap-4">
                <button id="statsBtn" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300 transition">Stats</button>
                <button id="settingsBtn" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300 transition">Settings</button>
            </div>
        </header>

        <!-- Main content -->
        <main class="flex flex-col gap-8">
            <!-- Welcome screen -->
            <div id="welcomeScreen" class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4">Welcome to Algorithm Practice</h2>
                <p class="mb-4">Your spaced repetition system for mastering coding algorithms.</p>
                <div class="flex gap-4">
                    <button id="startPracticeBtn" class="px-6 py-3 bg-blue-600 text-white rounded hover:bg-blue-700 transition">Start Practice</button>
                    <button id="addNewCardBtn" class="px-6 py-3 bg-green-600 text-white rounded hover:bg-green-700 transition">Add New Algorithm</button>
                </div>
                <div class="mt-6">
                    <h3 class="text-xl font-medium mb-2">Today's Queue</h3>
                    <p id="todayCount" class="text-lg font-medium text-blue-600">0 algorithms to practice</p>
                </div>
            </div>

            <!-- Practice card -->
            <div id="practiceScreen" class="hidden">
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-semibold" id="challengeTitle">Merge Sort Algorithm</h2>
                        <div class="flex gap-2">
                            <select id="languageSelect" class="px-3 py-1 border rounded">
                                <option value="python">Python</option>
                                <option value="java">Java</option>
                                <option value="javascript">JavaScript</option>
                            </select>
                        </div>
                    </div>
                    <div class="mb-4">
                        <div class="mb-2 font-medium">Description:</div>
                        <div id="challengeDescription" class="text-gray-700">
                            Implement a merge sort algorithm that sorts an array of integers in ascending order.
                        </div>
                    </div>
                    <div class="mb-4">
                        <div class="mb-2 font-medium">Your Solution:</div>
                        <div id="editor" class="h-64 w-full border rounded"></div>
                    </div>
                    <div class="flex justify-between mt-6">
                        <button id="showSolutionBtn" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300 transition">Show Solution</button>
                        <div>
                            <button id="runCodeBtn" class="px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 transition mr-2">Run Code</button>
                            <button id="checkSolutionBtn" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition">Check Solution</button>
                        </div>
                    </div>
                </div>

                <!-- Solution rating -->
                <div id="ratingScreen" class="hidden mt-6 bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-medium mb-4">How well did you do?</h3>
                    <div class="flex justify-between max-w-md mx-auto">
                        <button class="rating-btn px-4 py-2 bg-red-100 rounded hover:bg-red-200 transition" data-rating="1">Again</button>
                        <button class="rating-btn px-4 py-2 bg-orange-100 rounded hover:bg-orange-200 transition" data-rating="2">Hard</button>
                        <button class="rating-btn px-4 py-2 bg-yellow-100 rounded hover:bg-yellow-200 transition" data-rating="3">Good</button>
                        <button class="rating-btn px-4 py-2 bg-green-100 rounded hover:bg-green-200 transition" data-rating="4">Easy</button>
                    </div>
                </div>

                <!-- Solution display -->
                <div id="solutionScreen" class="hidden mt-6 bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-medium mb-4">Reference Solution</h3>
                    <pre><code id="solutionCode" class="language-python"></code></pre>
                </div>
            </div>

            <!-- Add new card screen -->
            <div id="addCardScreen" class="hidden bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4">Add New Algorithm Challenge</h2>
                <div class="mb-4">
                    <label class="block mb-2 font-medium">Title:</label>
                    <input id="newCardTitle" type="text" class="w-full px-3 py-2 border rounded" placeholder="e.g., Merge Sort">
                </div>
                <div class="mb-4">
                    <label class="block mb-2 font-medium">Description:</label>
                    <textarea id="newCardDescription" class="w-full px-3 py-2 border rounded h-24" placeholder="Describe the algorithm challenge"></textarea>
                </div>
                <div class="mb-4">
                    <label class="block mb-2 font-medium">Language:</label>
                    <select id="newCardLanguage" class="px-3 py-2 border rounded">
                        <option value="python">Python</option>
                        <option value="java">Java</option>
                        <option value="javascript">JavaScript</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block mb-2 font-medium">Reference Solution:</label>
                    <div id="newCardSolutionEditor" class="h-64 w-full border rounded"></div>
                </div>
                <div class="flex justify-between mt-6">
                    <button id="cancelAddCardBtn" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300 transition">Cancel</button>
                    <button id="saveCardBtn" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition">Save Challenge</button>
                </div>
            </div>

            <!-- Stats screen -->
            <div id="statsScreen" class="hidden bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4">Practice Statistics</h2>
                <div class="flex flex-wrap gap-4 mb-6">
                    <div class="bg-blue-50 p-4 rounded-lg flex-1">
                        <h3 class="text-lg font-medium mb-2">Total Challenges</h3>
                        <p id="totalChallenges" class="text-2xl font-bold text-blue-600">0</p>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg flex-1">
                        <h3 class="text-lg font-medium mb-2">Mastered</h3>
                        <p id="masteredChallenges" class="text-2xl font-bold text-green-600">0</p>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded-lg flex-1">
                        <h3 class="text-lg font-medium mb-2">In Progress</h3>
                        <p id="inProgressChallenges" class="text-2xl font-bold text-yellow-600">0</p>
                    </div>
                </div>
                <div class="mb-6">
                    <h3 class="text-lg font-medium mb-2">Practice History</h3>
                    <div class="flex gap-1 h-32 items-end">
                        <div id="practiceChart" class="flex-1 flex gap-1"></div>
                    </div>
                </div>
                <button id="backFromStatsBtn" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300 transition">Back</button>
            </div>

            <!-- Settings screen -->
            <div id="settingsScreen" class="hidden bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4">Settings</h2>
                <div class="mb-4">
                    <label class="block mb-2 font-medium">Daily New Cards Limit:</label>
                    <input id="newCardsLimit" type="number" min="1" max="20" value="5" class="w-32 px-3 py-2 border rounded">
                </div>
                <div class="mb-4">
                    <label class="block mb-2 font-medium">Daily Review Limit:</label>
                    <input id="reviewLimit" type="number" min="1" max="100" value="20" class="w-32 px-3 py-2 border rounded">
                </div>
                <div class="mb-4">
                    <label class="block mb-2 font-medium">Theme:</label>
                    <select id="themeSelect" class="px-3 py-2 border rounded">
                        <option value="light">Light</option>
                        <option value="dark">Dark</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block mb-2 font-medium">
                        <input id="enableSyntaxHighlighting" type="checkbox" checked class="mr-2">
                        Enable Syntax Highlighting
                    </label>
                </div>
                <div class="mb-4">
                    <label class="block mb-2 font-medium">
                        <input id="exportData" type="button" value="Export Data" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300 transition">
                    </label>
                </div>
                <div class="mb-4">
                    <label class="block mb-2 font-medium">
                        <input id="importData" type="file" accept=".json" class="hidden">
                        <span class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300 transition cursor-pointer">Import Data</span>
                    </label>
                </div>
                <button id="backFromSettingsBtn" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300 transition">Back</button>
            </div>
        </main>
    </div>

    <script>
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize Ace editor
            const editor = ace.edit("editor");
            editor.setTheme("ace/theme/monokai");
            editor.session.setMode("ace/mode/python");
            editor.setFontSize(14);

            const newCardSolutionEditor = ace.edit("newCardSolutionEditor");
            newCardSolutionEditor.setTheme("ace/theme/monokai");
            newCardSolutionEditor.session.setMode("ace/mode/python");
            newCardSolutionEditor.setFontSize(14);

            // Initialize data
            let cards = JSON.parse(localStorage.getItem('algorithm-cards') || '[]');
            let settings = JSON.parse(localStorage.getItem('algorithm-settings') || '{"newCardsLimit":5,"reviewLimit":20,"theme":"light"}');
            let stats = JSON.parse(localStorage.getItem('algorithm-stats') || '{"practiced":{},"mastered":0,"inProgress":0}');
            let currentCardIndex = -1;
            let todayCards = [];

            // Sample data for new installations
            if (cards.length === 0) {
                cards = [
                    {
                        id: "merge-sort",
                        title: "Merge Sort Algorithm",
                        description: "Implement a merge sort algorithm that sorts an array of integers in ascending order.",
                        language: "python",
                        solution: `def merge_sort(arr):
    if len(arr) <= 1:
        return arr
        
    mid = len(arr) // 2
    left = merge_sort(arr[:mid])
    right = merge_sort(arr[mid:])
    
    return merge(left, right)

def merge(left, right):
    result = []
    i = j = 0
    
    while i < len(left) and j < len(right):
        if left[i] <= right[j]:
            result.append(left[i])
            i += 1
        else:
            result.append(right[j])
            j += 1
    
    result.extend(left[i:])
    result.extend(right[j:])
    return result

# Example usage
arr = [38, 27, 43, 3, 9, 82, 10]
sorted_arr = merge_sort(arr)
print(sorted_arr)  # Output: [3, 9, 10, 27, 38, 43, 82]`,
                        interval: 1,
                        ease: 2.5,
                        nextReview: new Date().toISOString().split('T')[0],
                        created: new Date().toISOString()
                    },
                    {
                        id: "binary-search",
                        title: "Binary Search Algorithm",
                        description: "Implement a binary search algorithm that finds the position of a target value within a sorted array.",
                        language: "python",
                        solution: `def binary_search(arr, target):
    left, right = 0, len(arr) - 1
    
    while left <= right:
        mid = (left + right) // 2
        
        if arr[mid] == target:
            return mid
        elif arr[mid] < target:
            left = mid + 1
        else:
            right = mid - 1
    
    return -1  # Target not found

# Example usage
sorted_arr = [3, 9, 10, 27, 38, 43, 82]
position = binary_search(sorted_arr, 27)
print(position)  # Output: 3`,
                        interval: 1,
                        ease: 2.5,
                        nextReview: new Date().toISOString().split('T')[0],
                        created: new Date().toISOString()
                    }
                ];
                localStorage.setItem('algorithm-cards', JSON.stringify(cards));
            }

            // Functions to handle the SM-2 algorithm (Anki's spaced repetition algorithm)
            function updateCardInterval(card, rating) {
                // Based on the SuperMemo-2 algorithm
                let newEase = card.ease;
                let newInterval = card.interval;
                
                if (rating === 1) {
                    // Again - Reset interval to 1
                    newInterval = 1;
                } else {
                    // Adjust ease based on performance
                    if (rating === 2) {
                        newEase = Math.max(1.3, card.ease - 0.15);
                    } else if (rating === 3) {
                        newEase = card.ease;
                    } else if (rating === 4) {
                        newEase = card.ease + 0.15;
                    }
                    
                    // Calculate new interval
                    if (card.interval === 1 && rating >= 2) {
                        newInterval = 6;
                    } else if (rating >= 2) {
                        newInterval = Math.round(card.interval * card.ease);
                    }
                }
                
                // Update card
                card.ease = newEase;
                card.interval = newInterval;
                
                // Calculate next review date
                const today = new Date();
                const nextReview = new Date(today);
                nextReview.setDate(today.getDate() + newInterval);
                card.nextReview = nextReview.toISOString().split('T')[0];
                
                return card;
            }

            // Function to get today's cards
            function getTodayCards() {
                const today = new Date().toISOString().split('T')[0];
                const dueCards = cards.filter(card => card.nextReview <= today);
                const newCards = cards.filter(card => !card.lastReviewed).slice(0, settings.newCardsLimit);
                const reviewCards = dueCards.filter(card => card.lastReviewed).slice(0, settings.reviewLimit);
                
                return [...newCards, ...reviewCards];
            }

            // Update today's count
            function updateTodayCount() {
                todayCards = getTodayCards();
                document.getElementById('todayCount').textContent = `${todayCards.length} algorithms to practice`;
            }

            // Update stats
            function updateStats() {
                // Calculate mastered and in progress
                const mastered = cards.filter(card => card.interval > 30).length;
                const inProgress = cards.length - mastered;
                
                stats.mastered = mastered;
                stats.inProgress = inProgress;
                
                // Update today's count in stats
                const today = new Date().toISOString().split('T')[0];
                stats.practiced[today] = (stats.practiced[today] || 0) + 1;
                
                // Save stats
                localStorage.setItem('algorithm-stats', JSON.stringify(stats));
                
                // Update stats display
                document.getElementById('totalChallenges').textContent = cards.length;
                document.getElementById('masteredChallenges').textContent = mastered;
                document.getElementById('inProgressChallenges').textContent = inProgress;
                
                // Update practice chart
                updatePracticeChart();
            }

            // Update practice chart
            function updatePracticeChart() {
                const chartContainer = document.getElementById('practiceChart');
                chartContainer.innerHTML = '';
                
                // Get last 14 days
                const days = [];
                const today = new Date();
                for (let i = 13; i >= 0; i--) {
                    const date = new Date(today);
                    date.setDate(today.getDate() - i);
                    days.push(date.toISOString().split('T')[0]);
                }
                
                // Create chart bars
                const maxCount = Math.max(...days.map(day => stats.practiced[day] || 0), 1);
                
                days.forEach(day => {
                    const count = stats.practiced[day] || 0;
                    const height = Math.max(10, Math.round((count / maxCount) * 100));
                    const date = new Date(day);
                    const dayName = date.toLocaleDateString('en-US', { weekday: 'short' }).slice(0, 2);
                    
                    const bar = document.createElement('div');
                    bar.className = 'flex flex-col items-center';
                    bar.innerHTML = `
                        <div class="text-xs mb-1">${count}</div>
                        <div class="w-full bg-blue-500 rounded-t" style="height: ${height}%"></div>
                        <div class="text-xs mt-1">${dayName}</div>
                    `;
                    chartContainer.appendChild(bar);
                });
            }

            // Show card
            function showCard(index) {
                if (index >= 0 && index < todayCards.length) {
                    currentCardIndex = index;
                    const card = todayCards[index];
                    
                    // Update UI
                    document.getElementById('challengeTitle').textContent = card.title;
                    document.getElementById('challengeDescription').textContent = card.description;
                    document.getElementById('languageSelect').value = card.language;
                    
                    // Clear and set editor mode
                    editor.setValue('');
                    editor.session.setMode(`ace/mode/${card.language}`);
                    
                    // Update solution code
                    document.getElementById('solutionCode').className = `language-${card.language}`;
                    document.getElementById('solutionCode').textContent = card.solution;
                    hljs.highlightElement(document.getElementById('solutionCode'));
                    
                    // Show practice screen
                    showScreen('practiceScreen');
                    
                    // Hide solution and rating screens
                    document.getElementById('solutionScreen').classList.add('hidden');
                    document.getElementById('ratingScreen').classList.add('hidden');
                }
            }

            // Show screen
            function showScreen(screenId) {
                // Hide all screens
                document.getElementById('welcomeScreen').classList.add('hidden');
                document.getElementById('practiceScreen').classList.add('hidden');
                document.getElementById('addCardScreen').classList.add('hidden');
                document.getElementById('statsScreen').classList.add('hidden');
                document.getElementById('settingsScreen').classList.add('hidden');
                
                // Show the requested screen
                document.getElementById(screenId).classList.remove('hidden');
            }

            // Event listeners
            document.getElementById('startPracticeBtn').addEventListener('click', () => {
                updateTodayCount();
                if (todayCards.length > 0) {
                    showCard(0);
                } else {
                    alert('No cards due for today. Try adding some new cards!');
                }
            });

            document.getElementById('addNewCardBtn').addEventListener('click', () => {
                showScreen('addCardScreen');
                newCardSolutionEditor.setValue('');
            });

            document.getElementById('statsBtn').addEventListener('click', () => {
                showScreen('statsScreen');
                updateStats();
            });

            document.getElementById('settingsBtn').addEventListener('click', () => {
                showScreen('settingsScreen');
                document.getElementById('newCardsLimit').value = settings.newCardsLimit;
                document.getElementById('reviewLimit').value = settings.reviewLimit;
                document.getElementById('themeSelect').value = settings.theme;
            });

            document.getElementById('languageSelect').addEventListener('change', function() {
                editor.session.setMode(`ace/mode/${this.value}`);
            });

            document.getElementById('showSolutionBtn').addEventListener('click', () => {
                document.getElementById('solutionScreen').classList.toggle('hidden');
            });

            document.getElementById('checkSolutionBtn').addEventListener('click', () => {
                document.getElementById('ratingScreen').classList.remove('hidden');
            });

            document.getElementById('backFromStatsBtn').addEventListener('click', () => {
                showScreen('welcomeScreen');
            });

            document.getElementById('backFromSettingsBtn').addEventListener('click', () => {
                // Save settings
                settings.newCardsLimit = parseInt(document.getElementById('newCardsLimit').value);
                settings.reviewLimit = parseInt(document.getElementById('reviewLimit').value);
                settings.theme = document.getElementById('themeSelect').value;
                localStorage.setItem('algorithm-settings', JSON.stringify(settings));
                
                showScreen('welcomeScreen');
            });

            document.getElementById('cancelAddCardBtn').addEventListener('click', () => {
                showScreen('welcomeScreen');
            });

            document.getElementById('saveCardBtn').addEventListener('click', () => {
                const title = document.getElementById('newCardTitle').value.trim();
                const description = document.getElementById('newCardDescription').value.trim();
                const language = document.getElementById('newCardLanguage').value;
                const solution = newCardSolutionEditor.getValue();
                
                if (!title || !description || !solution) {
                    alert('Please fill in all fields');
                    return;
                }
                
                // Create new card
                const newCard = {
                    id: title.toLowerCase().replace(/\s+/g, '-'),
                    title,
                    description,
                    language,
                    solution,
                    interval: 1,
                    ease: 2.5,
                    nextReview: new Date().toISOString().split('T')[0],
                    created: new Date().toISOString()
                };
                
                // Add to cards
                cards.push(newCard);
                localStorage.setItem('algorithm-cards', JSON.stringify(cards));
                
                // Update today's count
                updateTodayCount();
                
                // Show welcome screen
                showScreen('welcomeScreen');
            });

            document.querySelectorAll('.rating-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const rating = parseInt(btn.dataset.rating);
                    
                    // Update card
                    const card = todayCards[currentCardIndex];
                    card.lastReviewed = new Date().toISOString();
                    updateCardInterval(card, rating);
                    
                    // Save cards
                    localStorage.setItem('algorithm-cards', JSON.stringify(cards));
                    
                    // Update stats
                    updateStats();
                    
                    // Show next card or go back to welcome screen
                    if (currentCardIndex < todayCards.length - 1) {
                        showCard(currentCardIndex + 1);
                    } else {
                        showScreen('welcomeScreen');
                        updateTodayCount();
                    }
                });
            });

            // Export data
            document.getElementById('exportData').addEventListener('click', () => {
                const data = {
                    cards,
                    settings,
                    stats
                };
                
                const blob = new Blob([JSON.stringify(data)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'algorithm-practice-data.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            });

            // Import data
            document.getElementById('importData').addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        try {
                            const data = JSON.parse(event.target.result);
                            if (data.cards && data.settings && data.stats) {
                                cards = data.cards;
                                settings = data.settings;
                                stats = data.stats;
                                
                                localStorage.setItem('algorithm-cards', JSON.stringify(cards));
                                localStorage.setItem('algorithm-settings', JSON.stringify(settings));
                                localStorage.setItem('algorithm-stats', JSON.stringify(stats));
                                
                                updateTodayCount();
                                alert('Data imported successfully');
                            } else {
                                alert('Invalid data format');
                            }
                        } catch (error) {
                            alert('Error importing data: ' + error.message);
                        }
                    };
                    reader.readAsText(file);
                }
            });

            // Run code button
            document.getElementById('runCodeBtn').addEventListener('click', () => {
                alert('Code execution is not available in this version. Check your solution against the reference solution.');
            });

            // Initialize
            updateTodayCount();
        });
    </script>
</body>
</html>